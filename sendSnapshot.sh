#!/usr/bin/env sh

SERVER="ws://127.0.0.1:8001/ws"

UUID=`(echo '{"cmd": "show_uuid"}';sleep 0.1 )| websocat $SERVER | jq -r .player_id`
# UUID="53f41803-eedf-4f08-a3d0-4bc01dee5aa2"

# snapshots
init='{"type":"game_state_snapshot","players":[{"player":{"id":"'$UUID'","nickname":"aa"},"pos":"P0","role":"spectator","ready":false}],"turn":"Pregame","deal":{"hand":[18295981441286144,524529],"current":"P0","contract":null,"scores":[0.0,0.0,0.0,0.0,0.0],"last_trick":{"cards":[null,null,null,null,null],"first":"P0","winner":"P0"},"initial_dog":[0,0]},"scores":[]}'
bidding='{"type":"game_state_snapshot","players":[{"player":{"id":"'$UUID'","nickname":"bb"},"pos":"P0","role":"pre_deal","ready":true},{"player":{"id":"6abeaa52-24f5-4810-8d20-eedf2eff6f98","nickname":"bb"},"pos":"P1","role":"pre_deal","ready":true},{"player":{"id":"a298f6dc-acf3-47ab-a618-4b6d7e044097","nickname":"VUT-QHF"},"pos":"P2","role":"pre_deal","ready":true},{"player":{"id":"6c32ed3e-e809-437f-a973-16b8f7842842","nickname":"ccc"},"pos":"P3","role":"pre_deal","ready":true},{"player":{"id":"dbfcbfab-223a-4b4e-ba48-c15fcaf492cd","nickname":"ddd"},"pos":"P4","role":"pre_deal","ready":true}],"turn":{"Bidding":["Bidding","P0"]},"deal":{"hand":[5085258058106,17334336],"current":"P0","contract":null,"scores":[0.0,0.0,0.0,0.0,0.0],"last_trick":{"cards":[null,null,null,null,null],"first":"P0","winner":"P0"},"initial_dog":[0,0]},"scores":[]}'
callking='{"type":"game_state_snapshot","players":[{"player":{"id":"'$UUID'","nickname":"bb"},"pos":"P0","role":"taker","ready":true},{"player":{"id":"6abeaa52-24f5-4810-8d20-eedf2eff6f98","nickname":"bb"},"pos":"P1","role":"pre_deal","ready":true},{"player":{"id":"a298f6dc-acf3-47ab-a618-4b6d7e044097","nickname":"VUT-QHF"},"pos":"P2","role":"pre_deal","ready":true},{"player":{"id":"6c32ed3e-e809-437f-a973-16b8f7842842","nickname":"ccc"},"pos":"P3","role":"pre_deal","ready":true},{"player":{"id":"dbfcbfab-223a-4b4e-ba48-c15fcaf492cd","nickname":"ddd"},"pos":"P4","role":"pre_deal","ready":true}],"turn":"CallingKing","deal":{"hand":[5085258058106,17334336],"current":"P0","contract":{"author":"P0","target":"Garde"},"scores":[0.0,0.0,0.0,0.0,0.0],"last_trick":{"cards":[null,null,null,null,null],"first":"P0","winner":"P0"},"initial_dog":[0,0]},"scores":[]}'
makedog='{"type":"game_state_snapshot","players":[{"player":{"id":"'$UUID'","nickname":"bb"},"pos":"P0","role":"taker","ready":true},{"player":{"id":"6abeaa52-24f5-4810-8d20-eedf2eff6f98","nickname":"bb"},"pos":"P1","role":"pre_deal","ready":true},{"player":{"id":"a298f6dc-acf3-47ab-a618-4b6d7e044097","nickname":"VUT-QHF"},"pos":"P2","role":"pre_deal","ready":true},{"player":{"id":"6c32ed3e-e809-437f-a973-16b8f7842842","nickname":"ccc"},"pos":"P3","role":"pre_deal","ready":true},{"player":{"id":"dbfcbfab-223a-4b4e-ba48-c15fcaf492cd","nickname":"ddd"},"pos":"P4","role":"pre_deal","ready":true}],"turn":"MakingDog","deal":{"hand":[5085258058106,17334336],"current":"P0","contract":{"author":"P0","target":"Garde"},"scores":[0.0,0.0,0.0,0.0,0.0],"last_trick":{"cards":[null,null,null,null,null],"first":"P0","winner":"P0"},"initial_dog":[4194816,128]},"scores":[]}'
playing='{"type":"game_state_snapshot","players":[{"player":{"id":"'$UUID'","nickname":"bb"},"pos":"P0","role":"taker","ready":true},{"player":{"id":"6abeaa52-24f5-4810-8d20-eedf2eff6f98","nickname":"bb"},"pos":"P1","role":"pre_deal","ready":true},{"player":{"id":"a298f6dc-acf3-47ab-a618-4b6d7e044097","nickname":"VUT-QHF"},"pos":"P2","role":"pre_deal","ready":true},{"player":{"id":"6c32ed3e-e809-437f-a973-16b8f7842842","nickname":"ccc"},"pos":"P3","role":"pre_deal","ready":true},{"player":{"id":"dbfcbfab-223a-4b4e-ba48-c15fcaf492cd","nickname":"ddd"},"pos":"P4","role":"pre_deal","ready":true}],"turn":{"Playing":"P4"},"deal":{"hand":[5085258058090,557248],"current":"P4","contract":{"author":"P0","target":"Garde"},"scores":[0.0,0.0,0.0,0.0,0.0],"last_trick":{"cards":[[0,16777216],[0,4194304],[0,8388608],[0,262144],null],"first":"P0","winner":"P0"},"initial_dog":[0,0]},"scores":[]}'
endtrick='{"type":"game_state_snapshot","players":[{"player":{"id":"'$UUID'","nickname":"bb"},"pos":"P0","role":"taker","ready":false},{"player":{"id":"6abeaa52-24f5-4810-8d20-eedf2eff6f98","nickname":"bb"},"pos":"P1","role":"pre_deal","ready":false},{"player":{"id":"a298f6dc-acf3-47ab-a618-4b6d7e044097","nickname":"VUT-QHF"},"pos":"P2","role":"pre_deal","ready":false},{"player":{"id":"6c32ed3e-e809-437f-a973-16b8f7842842","nickname":"ccc"},"pos":"P3","role":"pre_deal","ready":false},{"player":{"id":"dbfcbfab-223a-4b4e-ba48-c15fcaf492cd","nickname":"ddd"},"pos":"P4","role":"pre_deal","ready":false}],"turn":"Intertrick","deal":{"hand":[5085258058090,557248],"current":"P0","contract":{"author":"P0","target":"Garde"},"scores":[0.0,0.0,0.0,0.0,0.0],"last_trick":{"cards":[[0,16777216],[0,4194304],[0,8388608],[0,262144],[0,131072]],"first":"P0","winner":"P0"},"initial_dog":[0,0]},"scores":[]}'

SNAPSHOT=$playing

echo '{"cmd": "debug_ui", "player_id":"'$UUID'" , "snapshot": '$SNAPSHOT'}' | websocat $SERVER
